// const request = require("supertest");
// const mongoose = require("mongoose");
// const app = require("../index");
// const User = require("../models/User");
// const Property = require("../models/Property");
// const Cart = require("../models/Cart");
// const Category = require("../models/Category");
//
// let workerToken, Hirer1Token, Hirer2Token;
// let Hirer1Id, Hirer2Id;
// let propertyId1, propertyId2;
// let categoryId;
// const categoryNameForCartTest = "Category for Cart Properties";
//
// beforeAll(async () => {
//     process.env.MONGO_URI = process.env.MONGO_URI || "mongodb://localhost:27017/SkillLink_test_cart";
//     if (mongoose.connection.readyState === 0) {
//         await mongoose.connect(process.env.MONGO_URI, {
//             useNewUrlParser: true,
//             useUnifiedTopology: true,
//         });
//     }
//     await mongoose.connection.dropDatabase();
//
//     await request(app).post("/api/auth/register").send({
//         fullName: "Cart worker",
//         email: "cartworker@test.com",
//         phoneNumber: "9800000000",
//         stakeholder: "worker",
//         password: "password123",
//         confirmPassword: "password123",
//     });
//     const workerLoginRes = await request(app).post("/api/auth/login").send({
//         email: "cartworker@test.com",
//         password: "password123",
//     });
//     workerToken = workerLoginRes.body.token;
//
//     await request(app).post("/api/auth/register").send({
//         fullName: "Cart Hirer 1",
//         email: "cartHirer1@test.com",
//         phoneNumber: "9811111111",
//         stakeholder: "Hirer",
//         password: "password123",
//         confirmPassword: "password123",
//     });
//     const createdHirer1User = await User.findOne({ email: "cartHirer1@test.com" });
//     Hirer1Id = createdHirer1User._id;
//     const Hirer1LoginRes = await request(app).post("/api/auth/login").send({
//         email: "cartHirer1@test.com",
//         password: "password123",
//     });
//     Hirer1Token = Hirer1LoginRes.body.token;
//
//     await request(app).post("/api/auth/register").send({
//         fullName: "Cart Hirer 2",
//         email: "cartHirer2@test.com",
//         phoneNumber: "9822222222",
//         stakeholder: "Hirer",
//         password: "password123",
//         confirmPassword: "password123",
//     });
//     const createdHirer2User = await User.findOne({ email: "cartHirer2@test.com" });
//     Hirer2Id = createdHirer2User._id;
//     const Hirer2LoginRes = await request(app).post("/api/auth/login").send({
//         email: "cartHirer2@test.com",
//         password: "password123",
//     });
//     Hirer2Token = Hirer2LoginRes.body.token;
//
//     const createCategoryRes = await request(app)
//         .post("/api/category")
//         .set("Authorization", `Bearer ${workerToken}`)
//         .send({ name: categoryNameForCartTest });
//     categoryId = createCategoryRes.body.data._id;
//
//     const createPropertyRes1 = await request(app)
//         .post("/api/properties")
//         .set("Authorization", `Bearer ${workerToken}`)
//         .send({
//             title: "Cart Test Apartment",
//             description: "An apartment for cart test.",
//             price: 100000,
//             location: "Cart Test Location 1",
//             bedrooms: 2,
//             bathrooms: 1,
//             categoryName: categoryNameForCartTest,
//             images: ["http://example.com/cart_img1.jpg"],
//             videos: [],
//         });
//     propertyId1 = createPropertyRes1.body.data._id;
//
//     const createPropertyRes2 = await request(app)
//         .post("/api/properties")
//         .set("Authorization", `Bearer ${workerToken}`)
//         .send({
//             title: "Cart Test House",
//             description: "A house for cart test.",
//             price: 200000,
//             location: "Cart Test Location 2",
//             bedrooms: 3,
//             bathrooms: 2,
//             categoryName: categoryNameForCartTest,
//             images: ["http://example.com/cart_img2.jpg"],
//             videos: [],
//         });
//     propertyId2 = createPropertyRes2.body.data._id;
// });
//
// afterAll(async () => {
//     if (mongoose.connection.readyState !== 0) {
//         await mongoose.disconnect();
//     }
// });
//
// describe("Cart API", () => {
//     beforeEach(async () => {
//         await Cart.deleteMany({});
//     });
//
//     test("should allow a Hirer to add a property to their cart", async () => {
//         const res = await request(app)
//             .post(`/api/cart/add`)
//             .set("Authorization", `Bearer ${Hirer1Token}`)
//             .send({ propertyId: propertyId1 });
//         expect(res.statusCode).toBe(200);
//         expect(res.body.success).toBe(true);
//     });
//
//     test("should prevent adding the same property twice to cart", async () => {
//         await request(app).post(`/api/cart/add`).set("Authorization", `Bearer ${Hirer1Token}`).send({ propertyId: propertyId1 });
//         const res = await request(app).post(`/api/cart/add`).set("Authorization", `Bearer ${Hirer1Token}`).send({ propertyId: propertyId1 });
//         expect(res.statusCode).toBe(400);
//     });
//
//     test("should allow a Hirer to remove a property from their cart", async () => {
//         await request(app).post(`/api/cart/add`).set("Authorization", `Bearer ${Hirer1Token}`).send({ propertyId: propertyId2 });
//         const res = await request(app).delete(`/api/cart/remove/${propertyId2}`).set("Authorization", `Bearer ${Hirer1Token}`);
//         expect(res.statusCode).toBe(200);
//     });
//
//     test("should get an empty cart for a Hirer with no items", async () => {
//         const res = await request(app).get("/api/cart").set("Authorization", `Bearer ${Hirer2Token}`);
//         expect(res.statusCode).toBe(200);
//         expect(res.body.data.items).toEqual([]);
//     });
//
//     test("should return 401 if unauthorized user tries to access cart endpoints", async () => {
//         const resAdd = await request(app).post(`/api/cart/add`).send({ propertyId: propertyId1 });
//         expect(resAdd.statusCode).toBe(401);
//
//         const resRemove = await request(app).delete(`/api/cart/remove/${propertyId1}`);
//         expect(resRemove.statusCode).toBe(401);
//
//         const resGet = await request(app).get("/api/cart");
//         expect(resGet.statusCode).toBe(401);
//     });
//
//     test("should get cart with multiple items", async () => {
//         await request(app).post(`/api/cart/add`).set("Authorization", `Bearer ${Hirer1Token}`).send({ propertyId: propertyId1 });
//         await request(app).post(`/api/cart/add`).set("Authorization", `Bearer ${Hirer1Token}`).send({ propertyId: propertyId2 });
//         const res = await request(app).get("/api/cart").set("Authorization", `Bearer ${Hirer1Token}`);
//         expect(res.statusCode).toBe(200);
//         expect(res.body.data.items.length).toBe(2);
//     });
// });
